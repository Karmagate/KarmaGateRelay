services:
  relay:
    build: .
    container_name: karmagate-relay
    restart: unless-stopped
    ports:
      - "8443:8443"
    environment:
      - RELAY_ADDR=:8443
      - RELAY_TLS_CERT=/certs/cert.pem
      - RELAY_TLS_KEY=/certs/key.pem
      - RELAY_MAX_ROOMS=1000
      - RELAY_MAX_CLIENTS_PER_ROOM=20
      - RELAY_MAX_MESSAGE_SIZE=2097152
      - RELAY_ROOM_IDLE_TIMEOUT=7200
      - RELAY_RATE_LIMIT_PER_IP=100
    volumes:
      - ./certs:/certs:ro
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "--no-check-certificate", "https://localhost:8443/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 5s
